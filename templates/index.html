{% extends "layout.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Phone Inventory</h2>
    <div>
        <a href="{{ url_for('add_phone') }}" class="btn btn-success">Add New Phone</a>
        <a href="{{ url_for('upload_file') }}" class="btn btn-info">Bulk Upload</a>
    </div>
</div>

<form method="GET" class="mb-4 p-3 border rounded">
    <div class="row g-3 align-items-center">
        <div class="col-md-4">
            <input type="text" name="search" class="form-control" placeholder="Search by Model or Brand...">
        </div>
        <div class="col-md-3">
            <select name="condition" class="form-select">
                <option value="">Filter by Condition...</option>
                <option value="New">New</option>
                <option value="Excellent">Excellent</option>
                <option value="Good">Good</option>
                <option value="Usable">Usable</option>
                <option value="Scrap">Scrap</option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="platform" class="form-select">
                <option value="">Filter by Platform...</option>
                <option value="X">Listed on X</option>
                <option value="Y">Listed on Y</option>
                <option value="Z">Listed on Z</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Apply</button>
        </div>
    </div>
</form>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead>
            <tr>
                <th>Model</th>
                <th>Brand</th>
                <th>Base Price</th>
                <th>Total Stock</th>
                <th>Reserved B2B</th>
                <th>Available Stock</th>
                <th>Condition</th>
                <th>Platform X Price</th>
                <th>Platform Y Price</th>
                <th>Platform Z Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for phone in phones %}
            <tr class="{% if phone.available_stock == 0 %}table-danger{% endif %}">
                <td>
                    <strong>{{ phone.model_name }}</strong><br>
                    <small class="text-muted">{{ phone.specifications }}</small>
                </td>
                <td>{{ phone.brand }}</td>
                <td>${{ "%.2f"|format(phone.base_price) }}</td>
                <td>{{ phone.stock_quantity }}</td>
                <td><span class="badge bg-secondary">{{ phone.reserved_for_b2b }}</span></td>
                <td>
                    {% if phone.available_stock > 0 %}
                        <span class="badge bg-success">{{ phone.available_stock }}</span>
                    {% else %}
                        <span class="badge bg-danger">0</span>
                    {% endif %}
                    {% if phone.tags %}
                        <span class="badge bg-warning">{{ phone.tags }}</span>
                    {% endif %}
                </td>
                <td>{{ phone.condition }}</td>
                <td>
                    ${{ "%.2f"|format(phone.price_on_x) }}<br>
                    {% if phone.is_listed_on_x %}
                        <span class="badge bg-success">Listed</span>
                    {% else %}
                        <form action="{{ url_for('list_on_platform', phone_id=phone.id, platform='X') }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-secondary">List</button>
                        </form>
                    {% endif %}
                </td>
                <td>
                    ${{ "%.2f"|format(phone.price_on_y) }}<br>
                    {% if phone.is_listed_on_y %}
                        <span class="badge bg-success">Listed</span>
                    {% else %}
                        <form action="{{ url_for('list_on_platform', phone_id=phone.id, platform='Y') }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-secondary">List</button>
                        </form>
                    {% endif %}
                </td>
                <td>
                    ${{ "%.2f"|format(phone.price_on_z) }}<br>
                    {% if phone.is_listed_on_z %}
                        <span class="badge bg-success">Listed</span>
                    {% else %}
                        <form action="{{ url_for('list_on_platform', phone_id=phone.id, platform='Z') }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-secondary">List</button>
                        </form>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('edit_phone', phone_id=phone.id) }}" class="btn btn-sm btn-warning">Edit</a>
                    <form action="{{ url_for('delete_phone', phone_id=phone.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this phone?');">
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="11" class="text-center">No phones found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
